## APISEC Exploiting API Authorization

Authorization vulnerabilities are still the most common API vulnerabilities.

### BOLA - Broken Object Level Authorization

If authorization controls are lacking or missing, userA can request userB's resouces. This is because APIs use values to identify various objects. If we discover these object IDs we should test if we can interact with other user's resources when we are not authenticated to do so.

There are three requirements for BOLA:
- resourceID
- Requests that access resources
- Missing or flawed access controls

Look for the following kind of requests when scanning API paths.
```
GET /api/resource/1
GET /user/account/find?user_id=15
POST /company/account/Apple/balance
POST /admin/pwreset/account/90
In these instances, you can probably guess other potential resources, like the following, by altering the bold values:

GET /api/resource/3
GET /user/account/find?user_id=23
POST /company/account/Google/balance
POST /admin/pwreset/account/111
```

In the example scenario we find a vehicle ID from another response that belongs to another user (forum endpoint) and then use that to access the location data of that vehicle from another user.


### BFLA - Broken Function Level Authorization
Contrary BOLA, BFLA is all about performing unauthorized actions. These are common vulnerabilities for requests that perform actions of other users. They can be lateral or escalated actions, i.e. actions of same role or an administrator. The main difference is were looking for functional requests for example user should be able to delete their own profile picture but not the profile picture of others or administrator actions.

Were looking for
- ResourceID
- Requests that perform authorized actions (PUT, DELETE etc)
- Missing or flawed access controls
 
In the example scenario one of the functions has proper access controls and doesn't allow us to get the orders of another user, but the other function that is used to change video name's lets us change user A's video name with user B's authentication token. (remembering we get these tokens from the POST login)
If we try to use DELETE function we get the following respone:
```
{"message":"This is an admin function. Try to access the admin API","status":403}
```
So previously we were sending requests to endpoint:
```<URL>/identity/api/v2/user/videos/<video_ID>``` from the response and looking at the previous endpoint we can notice that maybe there is an admin API ;) so we change the targeted endpoint to ```<URL>/identity/api/v2/admin/videos/<video_ID>``` and VOILA we deleted their video!

In the second example we first look at the documentation to figure out how we can get an authorization token, this is from the ```<URL>/vapi/tokens/``` endpoint. We then capture an GET request to ```/vapi/api1/user/<user_id>``` and as we saw from the create user response the user_id is a simple integer, so I just tested from 1 onwards and VOILA we we're able to get the user information of other user's we are also able to change the information of other users.





