# APISEC endpoint analysis notes

## Reverse Engineering an API
**Postman** has a function to capture requests via proxy, remember to setup foxyproxy to redirect to postman proxy. The captured requests can furthermore be saved to collections, which are a good way to keep log of what you have done. The first lesson seems to be more about how to keep clean track of captured requests.

**mitmproxy** enables similar functionalities over a web GUI, we can foxyproxy redirect into it at port 8888 (in our case) and start browsing a web application and crawl to find information about the API. We can then use mitmproxy2swagger to get a nice swagger file containing the API information we managed to gather with mitmproxy. For example: 

```mitmproxy2swagger -i <flow_file> -o <output>.yml -p <website_URL> -f flow```.

 Sometimes we have to manually adjust the x-path-templates in the output.yml and remove ignore from API endpoints that we want to explore later and you might want to run the above command again to generate the swaggerfile which we can then preview in the swagger editor. We could potentially find vulnerabilities by looking at the response values. Furthermore, we can generate curl requests directly from the swagger editor for different endpoints. At last we can import the output.yml to postman to get an organized directory structure for the API requests.

## Using APIs and Excessive Data exposure

Successful login requests for example can provide us the token that we can use later with for example Postman. We can then edit the collection and save the Auth token for the rest of the requests in that collection.

in the crAPI case it would be 
```{{baseUrl}}/identity/api/auth/login```

We can resend this request and grab the Bearer token from the response.

Scripts are another useful function in the collection settings for running different commands such as getting an environment variable.

We can also run the whole collection in postman, but then we need to create a script, for example to take all the status code 200's from the responses.

With **Burp Suite** we can also find the same information as with the postman tool by first proxying the data from browser to burpsuite proxy, then sending the request to **Repeater** and then observing the response.

### API3:2019 Excessive Data Exposure:


Excessive Data Exposure occurs when an API provider sends back a full data object, typically depending on the client to filter out the information that they need. From an attacker's perspective, the security issue here isn't that too much information is sent, instead, it is more about the sensitivity of the sent data. This vulnerability can be discovered as soon as you are able to start making requests. API requests of interest include user accounts, forum posts, social media posts, and information about groups (like company profiles).

Ingredients for excessive data exposure:

A response that includes more information than what was requested
Sensitive Information that can be leveraged in more complex attacks
If an API provider responds with an entire data object, then the first thing that could tip you off to excessive data exposure is simply the size of the response.

