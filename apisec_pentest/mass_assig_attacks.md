## APISEC Mass Assignment Attacks Notes

This means that an attacker is able to overwrite object properties when they should not be able to. An API must have requests that accept user input, these requests must be able to alter values not available to the user, and the API must be missing security controls that would prevent the alteration of data objects.

E.x. Attacker adds parameters to user registration to escalate their privileges to Administrator level.

Eseentially we want to find parameters used in requests and see if we can use those in other requests. Registration is usually the first point of attack to test.

Original register request
```
{
    "name":"massassignmentaccount1",
    "email":"massassignmentaccount1@gmail.com",
    "number":"123123123124",
    "password":"Password1!"
}
```
We then try by adding additional parameters
```
{
    "name":"massassignmentaccount1",
    "email":"massassignmentaccount1@gmail.com",
    "number":"123123123124",
    "isadmin": "true",
    "password":"Password1!"
}
```
The response is exactly the same from both requests, so there could be sanitisation in the crAPI end. By checking the vulnerable endpoint for data exposure we notice that there isn't any extra parameters with the new account that was created with extra parameters.

We then used Param Miner extension to try to figure out extra parameters that would be valid for the request, but didn't find anything interesting.

We then look at the previously created postman collection to find if there are any interesting parameters in the different requests and create a new collection for testing purposes with those requests. We want to use the API as it was intended to get an idea for the naming scheme.

We dont always need to intercept each request & response, we can also look at the Proxy -> HTTP history to see what was sent if were exploring for parameters or just looking at a lot of different functionalities of the API.

If you find one vulnerability in one part of the API, chances are its also vulnerable in other areas of the API as well.

By thinking about the previous BFLA vulnerabilities and using what we learned there in the following endpoint ```<URL>/workshop/api/shop/products/``` we can figure out that with the following POST request parameters, we can create new products:

```
{
    "name": ["This field is required."],
    "price":    ["This field is required."],
    "image_url":    ["This field is required."]
}
```

By using correct format in the request we created a new product WOOP! It even accepted a negative price so we were able to get our balance up to 1000$ by assigning a new items value to -1000$!

We found another BOLA vulnerability from the mechanic contact response by changing the ID parameter we were able to see other mechanic reports from the endpoint 
```{{baseUrl}}/workshop/api/mechanic/mechanic_report?report_id={{id}}```

In the practical quiz we first create (POST) a normal user in the endpoint ```http://{{host}}/vapi/api6/user/``` then GET the users details and notice extra field credit in the response. We then create a new user with the credit parameter and GET that user's details and VOILA we notice a MA vulnerability, we were able to create a new user with a chosen amount of credits!

```
{
    "id": 5102,
    "name": "hello123",
    "username": "hello112",
    "credit": "1000",
    "flag": "flag{api6_afb969db8b6e272694b4}"
}
```







