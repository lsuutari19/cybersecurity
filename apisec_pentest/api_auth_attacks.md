## APISEC API authentication attacks notes

Bruteforcing, password spraying --> password + username combinations

Decoded JWTs always start with "ey"

TLDR:
Password spraying is an authentication attack where we will attempt to authenticate using a long list of users and a short list of targeted passwords.



### Classic Authentication Attacks

**Burp suite intruder**
Proxy login -> send to Repeater (check response types) -> send to Intruder (password spraying payload 1 + payload 2). Then organizing my response Length usually yields the successful combinations at the top of the list.

Note: Sometimes it may be necessary to remove URL encoding from the payload lists. otherwise there might be something like %20 in the URL.

**wfuzz** is another comparable tool to Intruder. An important thing is to remember including headers via flag -H and -d for postdata to get the JSON format from wfuzz.

other nice flags:
```
--hc/hl/hw/hh N[,N]+: Hide responses with the specified code/lines/words/chars (Use BBB for taking values from baseline)

--sc/sl/sw/sh N[,N]+: Show responses with the specified code/lines/words/chars (Use BBB for taking values from baseline)

--ss/hs regex: Show/hide responses with the specified regex within the content
```

example wfuzz command:

```wfuzz -d '{"email":"hapihacker@email.com","password":"FUZZ"}' -H 'Content-Type: application/json' -z file,/usr/share/wordlists/rockyou.txt -u http://127.0.0.1:8888/identity/api/auth/login --hc 500 ```

where -d = destination, -H = headers, -z = payload, -u = target, --hc = ignore code X

Another method is the previously mentioned password spraying which is better in the fact that you can mold your attack to fit the account lockout policy.

### API Token Attacks
Postman send request to port 8080 proxy --> to Burp Suite --> Sequencer --> Custom location (highlight token) --> start live capture

With this we can analyze the token randomness and analyze the character set to bruteforce the character positions through the intruder by setting each of the last three characters as variables to brute force with brute forcer payloads.

**jwt.io** is a great website to decode/analyze tokens and see their contents and furthermore modify tokens to test them at postman/burp.

**jwt_tool** is another method to see the contents of tokens, in the laboratory we can send a valid login request, intercept the response, take the token and run a command ```jwt_tool <token>``` to get the decoded token values, example output:
```
=====================
Decoded Token Values:                                                                                       
=====================                                                                                       

Token header values:                                                                                        
[+] alg = "RS256"

Token payload values:                                                                                       
[+] sub = "hapihacker@email.com"
[+] iat = 1733506651    ==> TIMESTAMP = 2024-12-06 12:37:31 (UTC)
[+] exp = 1734111451    ==> TIMESTAMP = 2024-12-13 12:37:31 (UTC)
[+] role = "user"

Seen timestamps:                                                                                            
[*] iat was seen
[*] exp is later than iat by: 7 days, 0 hours, 0 mins

----------------------                                                                                      
JWT common timestamps:                                                                                      
iat = IssuedAt                                                                                              
exp = Expires                                                                                               
nbf = NotBefore                                                                                             
---------------------- 
```
jwt_tool does also have automatic attack options such as 
```
jwt_tool -t <target> -rh "Authorization: Bearer <token>" -M pb
```
where -M siginified mode and pb stands for playbook.

Note: REMEMBER TO TURN OFF BURP SUITE INTERCEPT WHEN RUNNING THIS :D


With **crunch** we can generate passwords that we can then use with JWT_tool to crack the key that is used to create the tokens with command ```jwt_tool <token> -C -d <crunch_generated>``` and then we can greate our own tokens for different users to get information that they can access.